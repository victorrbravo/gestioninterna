<script>
myval = 0;
</script>

{% extends "layouts/tc_main_layout.html" %}

{% block title %}Gestión Interna - Cambiar Estado{% end %}

{% block ownstyles %}
	<link href="/static/css/safetform.css" rel="stylesheet">

	<style type="text/css">

		#safetform input[type="file"]{
			display:none;
		}

		#safetform div.column {
			margin-top: 15px;
		}

		#safetform input[type="radio"]{
			margin-left: 20px;
		}
	</style>

{% end %}

{% block ownscripts %}
<script type="text/javascript">

function fieldSearch() {
	
	}

function createTable(data) {
	
	console.log("...createTable...");
	//******************************************
	var title = '<h2> Estado de la solicitud </h2> \n ';
    var head = '<div class=\'container\'> \n <table id=\' \' class=\'table table-bordered\'> \n <thead> \n <tr>\n <th>Estado</th>\n <th>Usuario</th> \n <th>Fecha</th> \n <th>Tiempo</th> \n <th>Espera</th> \n </tr>\n </thead>\n <tbody> \n';
    var footer = '</tbody> \n </table> \n </div>';
    var tableHtml = title + head;
    var estados = ["TalentoHumano", "DireccionInterna", "DireccionEjecutiva", "Finanzas", "Archivar_solicitud_procesada"]
    //*******************************************
    
   for (i = 0; i < 5; i++ ) {
		for (var pru in data) {
			var field = data[pru];
		    //console.log("estado: " + field['estado'] + " vs Estados: "+ estados[i]);
	        
	        if(field['estado'] == estados[i]) { 
				if(field['visita'] == true) {
					tableHtml += '<tr class="active">\n<td>' + estados[i] + '</td>\n<td>' + field['usuario'] + '</td>\n<td>' + field['fecha'] +' </td>\n<td>' + field['tiempo'] +'</td>\n<td>' + field['espera'] + ' </td>\n</tr>\n';
			    }			
				else  {
					tableHtml += '<tr>\n<td>' + estados[i] + '</td>\n<td>' + field['usuario'] + '</td>\n<td>' + field['fecha'] +' </td>\n<td>' + field['tiempo'] +'</td>\n<td>' + field['espera'] + ' </td>\n</tr>\n';
				}
			} else {
				//console.log("No son iguales");
				}
		}
	}
	tableHtml += footer;
	document.getElementById("table-status").innerHTML = tableHtml;
}


function jsonTable(datajson) {
	console.log("....jsonTable()....");
	//console.log("dataJson: %o", datajson);
	//******************************************
	var title = '<h2> Estado de la solicitud </h2> \n ';
    var head = '<div class=\'container\'> \n <table id=\' \' class=\'table table-bordered\'> \n <thead> \n <tr>\n <th>Estado</th>\n <th>Usuario</th> \n <th>Fecha</th> \n <th>Tiempo</th> \n <th>Espera</th> \n </tr>\n </thead>\n <tbody> \n';
    var footer = '</tbody> \n </table> \n </div>';
    var tableHtml = title + head;
    //*******************************************
	var dataJson = new Array();
	var data = new Array();
	var v_estado = "";
	var v_usuario = "";
	var v_fecha = "";
	var v_date = "";
	var v_tiempo = "";
	var v_espera = "";
	var v_visita = "";
	var objVarVerifique = JSON.parse(datajson);
	$.each(objVarVerifique, function(idx, obj) {
		if(idx == 'data') {
				fielData = obj;
				$.each(fielData, function(id, objx) { 
					if(id == 'nodes') {
						fielnode = objx;
						$.each(fielnode, function(idy, objy) { 
							fileobject = objy;
							var i = 0;
							$.each(fileobject, function(idyx, objyx) { 
							    if(idyx == 'name') {
									v_estado = objyx;
									console.log(idyx + ": " + v_estado );
									}
								if(idyx == 'parameter3') {
									v_usuario = objyx;
									v_visita = true;
									console.log("Usuario : " + v_usuario );
									}
								if(idyx == 'parameter4') {
									v_fecha = objyx;
									console.log("Fecha : " + v_fecha );
									}
								if(idyx == 'date') {
									v_date = objyx;
									console.log("Date : " + v_date );
									}
								if(idyx == 'parameter5') {
									v_tiempo = objyx;
									console.log("Tiempo : " + v_tiempo );
									}
								if(idyx == 'parameter6') {
									v_espera = objyx;
									console.log("Espera : " + v_espera );
									}	
						    });
						    i++;
						    if(v_visita == true) {
								tableHtml += '<tr class="active">\n<td>' + v_estado + '</td>\n<td>' + v_usuario + '</td>\n<td>' + v_fecha +' </td>\n<td>' + v_tiempo +'</td>\n<td>' + v_espera + ' </td>\n</tr>\n';
								}
							else  {
								tableHtml += '<tr>\n<td>' + v_estado + '</td>\n<td>' + v_usuario + '</td>\n<td>' + v_fecha +' </td>\n<td>' + v_tiempo +'</td>\n<td>' + v_espera + ' </td>\n</tr>\n';
								}
						    data = {estado:v_estado, usuario:v_usuario, fecha:v_fecha, tiempo:v_tiempo, espera:v_espera, visita:v_visita};
						    dataJson.push(data);
						    if (v_estado == 'inicial') {dataJson.pop();}
						    if (v_estado == 'Iniciado') {dataJson.pop();}
						    if (v_estado == 'final') {dataJson.pop();}
						});
					}
				});	
			}
	 });
	tableHtml += footer;
	createTable(dataJson);
}

var mysubcategory = "";
var mydetailcategory = "";

function safetProcessAfter() {

	myval = $("#periodo_vacacional").val(); 
	console.log("Periodo Vacacional:" + myval);		

	myoperation = "operacion:Generar_gráfico_para_clave Clave: " + myval; 
	console.log("myoperation: " + myoperation);
            
            $.post('http://localhost:8080/ajaxconsole',{ operation: myoperation

                }, 
                    function(data) { 
			console.log("receiving...1..data");
			console.log("data: " + data);
			//jsonTable(data);
			jsonTable(data);
			myresult = eval("(" + data + ")" );
			myfile = myresult["filename"];
			console.log("myfile: " + myfile);
			$("#workflowid").attr("src","/static/tmp/" + myfile);			
			
			
                      }
		); 
}

</script>
<script src="/static/ckeditor/ckeditor.js"></script>


{% end %}



{% block panel %}

			<div class="panel panel-primary">
		      <div class="panel-heading">{{title}}</div>
		      <div class="panel-body">
		     	   {% raw mycode %}
		      </div>
		    </div>
		
<br/>

<div id="table-status"> </div>

<br/>
				<div class="panel panel-primary">
		      <div class="panel-heading">Gráfico de seguimiento de la solicitud</div>
		      <div class="panel-body">
		     	   <img id="workflowid" name="workflowid"  src="/static/img/seguimiento.png" />
		      </div>
		    </div>
				

{% end %}
